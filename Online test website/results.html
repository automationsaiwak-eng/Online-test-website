<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results - EduTest</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .score-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            padding: 50px 20px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(var(--primary-color) 0%, #e9ecef 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            position: relative;
        }

        .score-circle::before {
            content: '';
            width: 170px;
            height: 170px;
            background: white;
            border-radius: 50%;
            position: absolute;
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .stat-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            height: 100%;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-light bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#"><i class="fas fa-chart-bar me-2"></i>Results</a>
            <div class="dropdown">
                <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                    <img src="https://ui-avatars.com/api/?name=User" id="userAvatar" class="rounded-circle" width="35">
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="dashboard.html">Dashboard</a></li>
                    <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">

                <div class="score-card mb-5">
                    <h2 class="mb-4">Test Completed!</h2>
                    <h5 class="text-muted mb-4" id="testTitle">Test Title</h5>

                    <div class="score-circle" id="scoreCircle">
                        <div class="score-text">
                            <h1 class="display-3 fw-bold mb-0" id="percentage">0%</h1>
                            <small class="text-muted">Total Score</small>
                        </div>
                    </div>

                    <p class="lead mb-4" id="feedbackMsg">Great job!</p>

                    <div class="row g-3 justify-content-center">
                        <div class="col-4 col-md-3">
                            <div class="stat-box">
                                <h3 class="text-primary fw-bold mb-0" id="totalQ">0</h3>
                                <small class="text-muted">Total Qs</small>
                            </div>
                        </div>
                        <div class="col-4 col-md-3">
                            <div class="stat-box">
                                <h3 class="text-success fw-bold mb-0" id="correctQ">0</h3>
                                <small class="text-muted">Correct</small>
                            </div>
                        </div>
                        <div class="col-4 col-md-3">
                            <div class="stat-box">
                                <h3 class="text-danger fw-bold mb-0" id="wrongQ">0</h3>
                                <small class="text-muted">Wrong</small>
                            </div>
                        </div>
                    </div>

                    <div class="mt-5 d-flex justify-content-center gap-3">
                        <a href="dashboard.html" class="btn btn-outline-primary rounded-pill px-4">Back to Dashboard</a>
                        <button class="btn btn-primary rounded-pill px-4" onclick="print()">Print Result</button>
                    </div>
                </div>

                <!-- Simple Review Section (Optional) -->
                <div class="text-center">
                    <button class="btn btn-link text-muted" data-bs-toggle="collapse" data-bs-target="#reviewSection">
                        Show Detailed Answer Review <i class="fas fa-chevron-down ms-1"></i>
                    </button>
                </div>

                <div class="collapse mt-4" id="reviewSection">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <p class="text-center text-muted">Feature: Detailed question review would go here (showing
                                user answer vs correct answer).</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = checkAuth();
            if (!user) return;

            document.getElementById('userAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=6a11cb&color=fff`;

            // Get Result Data
            // Check URL for specific attempt ID, else use 'currentResult'
            const urlParams = new URLSearchParams(window.location.search);
            const attemptId = urlParams.get('attemptId');

            let result = null;

            if (attemptId) {
                const history = JSON.parse(localStorage.getItem('history_' + user.email)) || [];
                result = history.find(h => h.id == attemptId);
            } else {
                result = JSON.parse(localStorage.getItem('currentResult'));
            }

            if (!result) {
                alert('Result not found.');
                window.location.href = 'dashboard.html';
                return;
            }

            document.getElementById('testTitle').textContent = result.testTitle;
            document.getElementById('percentage').textContent = result.percentage + '%';
            document.getElementById('totalQ').textContent = result.totalQuestions;
            document.getElementById('correctQ').textContent = result.correctAnswers;
            document.getElementById('wrongQ').textContent = result.wrongAnswers;

            // Feedback Message
            const msg = document.getElementById('feedbackMsg');
            if (result.percentage >= 80) msg.textContent = 'Excellent Work! üåü';
            else if (result.percentage >= 50) msg.textContent = 'Good Job! You Passed. üëç';
            else msg.textContent = 'Keep practicing! You can do better. üí™';

            // Chart Animation
            const circle = document.getElementById('scoreCircle');
            const degree = result.percentage * 3.6;
            circle.style.background = `conic-gradient(#6a11cb 0% ${degree}deg, #e9ecef ${degree}deg 100%)`; // Simple primary color
            if (result.percentage < 50) {
                circle.style.background = `conic-gradient(#e74c3c 0% ${degree}deg, #e9ecef ${degree}deg 100%)`; // Red for fail
            } else if (result.percentage >= 80) {
                circle.style.background = `conic-gradient(#2ecc71 0% ${degree}deg, #e9ecef ${degree}deg 100%)`; // Green for excellent
            }
        });
    </script>
</body>

</html>